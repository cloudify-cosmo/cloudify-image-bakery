{
    "variables": {
        "password": ""
    },

    "builders": [{
        "type": "amazon-ebs",
        "region": "eu-west-1",
        "source_ami_filter": {
            "filters": {
                "virtualization-type": "hvm",
                "name": "Windows_Server-2012-R2_RTM-English-64Bit-Base-*",
                "root-device-type": "ebs"
            },
            "owners": ["801119661308"],
            "most_recent": true
        },
        "instance_type": "m3.medium",
        "ami_name": "win_agent_builder-ami {{timestamp}}",
        "user_data_file":"./ec2-userdata.ps1",
        "communicator": "winrm",
        "winrm_username": "Administrator",
        "winrm_use_ssl": true,
        "winrm_insecure": true
    }],

    "provisioners": [
        {
            "type": "powershell",
            "environment_vars": "password={{user `password`}}",
            "script": "init.ps1"
        }
    ]
}
